<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>mherit Vignette • mherit</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.3.1/jquery.min.js" integrity="sha256-FgpCb/KJQlLNfOu91ta32o/NMZxltwRo8QtmkMRdAu8=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.3.7/simplex/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha256-U5ZEeKfGNOja007MMD3YBI0A3OSZOQbeG6z2f2Y0hu8=" crossorigin="anonymous"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css" integrity="sha256-eZrrJcwDc/3uDhsdt61sL2oOBY362qM3lon1gyExkL0=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.4/clipboard.min.js" integrity="sha256-FiZwavyI2V6+EXO1U+xzLG3IKldpiTFf3153ea9zikQ=" crossorigin="anonymous"></script><!-- sticky kit --><script src="https://cdnjs.cloudflare.com/ajax/libs/sticky-kit/1.1.3/sticky-kit.min.js" integrity="sha256-c4Rlo1ZozqTPE2RLuvbusY3+SU1pQaJC0TjuhygMipw=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="mherit Vignette">
<meta property="og:description" content="">
<meta name="twitter:card" content="summary">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body>
    <div class="container template-article">
      <header><div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">mherit</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.1.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../articles/mherit.html">Get started</a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/DanielSprockett/mherit">
    <span class="fa fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      
      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1>mherit Vignette</h1>
                        <h4 class="author">Daniel Sprockett</h4>
            
            <h4 class="date">2018-12-16</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/DanielSprockett/mherit/blob/master/vignettes/mherit.Rmd"><code>vignettes/mherit.Rmd</code></a></small>
      <div class="hidden name"><code>mherit.Rmd</code></div>

    </div>

    
    
<div id="load-pacakages" class="section level2">
<h2 class="hasAnchor">
<a href="#load-pacakages" class="anchor"></a>Load Pacakages</h2>
<p>Load Packages.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"ggplot2"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"phyloseq"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"car"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"mets"</span>)
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/library">require</a></span>(<span class="st">"mherit"</span>)</code></pre></div>
</div>
<div id="import" class="section level2">
<h2 class="hasAnchor">
<a href="#import" class="anchor"></a>Import</h2>
<p>Import the phyloseq object.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
ps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/readRDS">readRDS</a></span>(<span class="st">"/Users/daniel/R_packages/mherit/data/twins_ps.rds"</span>)</code></pre></div>
</div>
<div id="subset" class="section level2">
<h2 class="hasAnchor">
<a href="#subset" class="anchor"></a>Subset</h2>
<p>Since some twins have mutliple samples, I’ll first de-duplicate the subjects. In the future, this may be added to a function as an optional check (i.e. checking to make sure twins’ samples were collected on the same day, etc.).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
samples_to_keep &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/get_variable">get_variable</a></span>(ps, <span class="st">"Sample_ID"</span>)[<span class="op">!</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/duplicated">duplicated</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/get_variable">get_variable</a></span>(ps, <span class="st">"Subject_ID"</span>))]
ps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/subset_samples-methods">subset_samples</a></span>(ps, Sample_ID <span class="op">%in%</span><span class="st"> </span>samples_to_keep)</code></pre></div>
<p>For the sake of speeding up this demonstration, next I’ll select 400 twin pairs at random to focus on.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
n &lt;-<span class="st"> </span><span class="dv">400</span>
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/Random">set.seed</a></span>(<span class="dv">8675309</span>)
families_to_keep &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/unique">unique</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/get_variable">get_variable</a></span>(ps, <span class="st">"Family_ID"</span>)), n)
ps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/subset_samples-methods">subset_samples</a></span>(ps, Family_ID <span class="op">%in%</span><span class="st"> </span>families_to_keep)</code></pre></div>
</div>
<div id="filter" class="section level2">
<h2 class="hasAnchor">
<a href="#filter" class="anchor"></a>Filter</h2>
<p>Remove taxa not seen at least once in at least 50% of the samples.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
ps &lt;-<span class="st"> </span><span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/filter_taxa">filter_taxa</a></span>(ps, <span class="cf">function</span>(x) <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sum">sum</a></span>(x <span class="op">&gt;=</span><span class="st"> </span><span class="dv">1</span>) <span class="op">&gt;</span><span class="st"> </span>(<span class="fl">0.50</span><span class="op">*</span><span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/length">length</a></span>(x)), <span class="ot">TRUE</span>)
ps
<span class="co">#&gt; phyloseq-class experiment-level object</span>
<span class="co">#&gt; otu_table()   OTU Table:         [ 102 taxa and 691 samples ]</span>
<span class="co">#&gt; sample_data() Sample Data:       [ 691 samples by 41 sample variables ]</span>
<span class="co">#&gt; tax_table()   Taxonomy Table:    [ 102 taxa by 8 taxonomic ranks ]</span>
<span class="co">#&gt; refseq()      DNAStringSet:      [ 102 reference sequences ]</span></code></pre></div>
<p>This leaves us with 691 samples and 102 taxa.</p>
<p>Lets check the how many MZ and DZ twins we are left with.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/table">table</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/get_variable">get_variable</a></span>(ps, <span class="st">"Zygosity"</span>))
<span class="co">#&gt; </span>
<span class="co">#&gt;  MZ  DZ </span>
<span class="co">#&gt; 390 301</span></code></pre></div>
<p>Ok, not bad.</p>
</div>
<div id="prepare-dataset" class="section level2">
<h2 class="hasAnchor">
<a href="#prepare-dataset" class="anchor"></a>Prepare Dataset</h2>
<p>Now I can use the <code><a href="../reference/add_ranks.html">add_ranks()</a></code> function to add higher taxonomic levels to the phyloseq object. For now I’ll just add the <code>Family</code> and <code>Genus</code> levels, but if you leave <code>ranks</code> empty, it’ll use all of the ranks available in the <code><a href="https://www.rdocumentation.org/packages/phyloseq/topics/tax_table-methods">tax_table()</a></code>.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
ps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/add_ranks.html">add_ranks</a></span>(ps, <span class="dt">ranks =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Family"</span>, <span class="st">"Genus"</span>))
<span class="co">#&gt; ASV names have been replaced.</span>
<span class="co">#&gt; </span><span class="al">WARNING</span><span class="co">: The phy_tree() and/or refseq() in your phyloseq object will be removed.</span>
<span class="co">#&gt; Agglomerated by Genus (n = 47).</span>
<span class="co">#&gt; Agglomerated by Family (n = 19).</span>
<span class="co">#&gt; Replacing invalid charaters in taxa_names() with .</span></code></pre></div>
<p>You can see that there are now taxonomic features present in the dataset that are higher than ASVs.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/sample">sample</a></span>(<span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/taxa_names-methods">taxa_names</a></span>(ps), <span class="dv">10</span>)
<span class="co">#&gt;  [1] "ASV_79_CAG.56"                    </span>
<span class="co">#&gt;  [2] "ASV_8_Escherichia.Shigella"       </span>
<span class="co">#&gt;  [3] "ASV_89_Ruminiclostridium_5"       </span>
<span class="co">#&gt;  [4] "ASV_23_Bacteroides_dorei.fragilis"</span>
<span class="co">#&gt;  [5] "Family_Akkermansiaceae"           </span>
<span class="co">#&gt;  [6] "ASV_59_Lachnospira"               </span>
<span class="co">#&gt;  [7] "ASV_80_Lachnospiraceae"           </span>
<span class="co">#&gt;  [8] "Genus_Coprococcus_3"              </span>
<span class="co">#&gt;  [9] "Genus_Bilophila"                  </span>
<span class="co">#&gt; [10] "ASV_53_Ruminococcaceae_UCG.005"</span></code></pre></div>
</div>
<div id="normalize" class="section level2">
<h2 class="hasAnchor">
<a href="#normalize" class="anchor"></a>Normalize</h2>
<p>If we take a look at the abundances of the first 2 taxa in the fist 5 samples, we can see this is count data (integers).</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/otu_table-methods">otu_table</a></span>(ps)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
<span class="co">#&gt; OTU Table:          [2 taxa and 5 samples]</span>
<span class="co">#&gt;                      taxa are columns</span>
<span class="co">#&gt;          ASV_1_Bacteroides_vulgatus ASV_2_Bacteroides_dorei.vulgatus</span>
<span class="co">#&gt; High1.13                          0                             2972</span>
<span class="co">#&gt; High1.17                        835                                0</span>
<span class="co">#&gt; High1.18                       3938                                0</span>
<span class="co">#&gt; High1.19                       1793                             2091</span>
<span class="co">#&gt; High1.1                        1577                             4661</span></code></pre></div>
<p>To make the data more normally distributed, I’ll use the <code><a href="../reference/normalize_for_heritability.html">normalize_for_heritability()</a></code> function to perform the Box-Cox transformation and then regress on a few covariates in my <code><a href="https://www.rdocumentation.org/packages/phyloseq/topics/sample_data-methods">sample_data()</a></code>. Notice that <code>Height</code> is not in the <code><a href="https://www.rdocumentation.org/packages/phyloseq/topics/sample_data-methods">sample_data()</a></code>. The output phyloseq object contains the residuals from the linear regression. In this functions and all of the functions in this package, you can set <code>verbose = FALSE</code> to suppress the message.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
ps &lt;-<span class="st"> </span><span class="kw"><a href="../reference/normalize_for_heritability.html">normalize_for_heritability</a></span>(ps, <span class="dt">covariates =</span> <span class="kw"><a href="https://www.rdocumentation.org/packages/base/topics/c">c</a></span>(<span class="st">"Host_Age"</span>, <span class="st">"Host_Sex"</span>, <span class="st">"Height"</span>), <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Adding pseduocount (+1) to ASV table.</span>
<span class="co">#&gt; Transforming ASV table to relative abundances.</span>
<span class="co">#&gt; Covariates found:</span>
<span class="co">#&gt;      Host_Age (class: integer, centered and scaled)</span>
<span class="co">#&gt;      Host_Sex (class: factor)</span>
<span class="co">#&gt;      Height not found in sample_variables(), and will be ignored.</span>
<span class="co">#&gt; Modeling Feature: ASV_1_Bacteroides_vulgatus</span>
<span class="co">#&gt; Modeling Feature: ASV_2_Bacteroides_dorei.vulgatus</span>
<span class="co">#&gt; Modeling Feature: ASV_3_Bacteroides_uniformis</span>
<span class="co">#&gt; Modeling Feature: ASV_4_Bacteroides_uniformis</span>
<span class="co">#&gt; Modeling Feature: ASV_5_Akkermansia_muciniphila</span>
<span class="co">#&gt; Modeling Feature: ASV_6_Agathobacter</span>
<span class="co">#&gt; Modeling Feature: ASV_7_Alistipes_putredinis</span>
<span class="co">#&gt; Modeling Feature: ASV_8_Escherichia.Shigella</span>
<span class="co">#&gt; Modeling Feature: ASV_9_Ruminococcus_2_bromii</span>
<span class="co">#&gt; Modeling Feature: ASV_10_Faecalibacterium_cf..prausnitzii</span>
<span class="co">#&gt; Modeling Feature: ASV_11_Christensenellaceae_R.7_group</span>
<span class="co">#&gt; Modeling Feature: ASV_12_Subdoligranulum</span>
<span class="co">#&gt; Modeling Feature: ASV_13_Blautia_obeum.provencensis.1</span>
<span class="co">#&gt; Modeling Feature: ASV_14_Ruminococcaceae_UCG.002</span>
<span class="co">#&gt; Modeling Feature: ASV_15_Parabacteroides_merdae</span>
<span class="co">#&gt; Modeling Feature: ASV_16_Faecalibacterium_prausnitzii</span>
<span class="co">#&gt; Modeling Feature: ASV_17_Bacteroides_caccae</span>
<span class="co">#&gt; Modeling Feature: ASV_18_Alistipes_finegoldii.onderdonkii</span>
<span class="co">#&gt; Modeling Feature: ASV_19_Bacteroides_faecichinchillae.faecis.2</span>
<span class="co">#&gt; Modeling Feature: ASV_20_Bacteroides_cellulosilyticus.intestinalis.1</span>
<span class="co">#&gt; Modeling Feature: ASV_21_Fusicatenibacter_saccharivorans</span>
<span class="co">#&gt; Modeling Feature: ASV_22_Bacteroides_fragilis.ovatus.1</span>
<span class="co">#&gt; Modeling Feature: ASV_23_Bacteroides_dorei.fragilis</span>
<span class="co">#&gt; Modeling Feature: ASV_24_Anaerostipes_hadrus</span>
<span class="co">#&gt; Modeling Feature: ASV_25_Bifidobacterium_adolescentis.faecale.2</span>
<span class="co">#&gt; Modeling Feature: ASV_26_Erysipelotrichaceae_UCG.003</span>
<span class="co">#&gt; Modeling Feature: ASV_27_Subdoligranulum</span>
<span class="co">#&gt; Modeling Feature: ASV_28_Faecalibacterium_CM04.06</span>
<span class="co">#&gt; Modeling Feature: ASV_29_Bacteroides_fragilis.ovatus</span>
<span class="co">#&gt; Modeling Feature: ASV_30_Blautia_massiliensis</span>
<span class="co">#&gt; Modeling Feature: ASV_31_Bacteroides_fragilis.ovatus</span>
<span class="co">#&gt; Modeling Feature: ASV_32_Dorea_longicatena</span>
<span class="co">#&gt; Modeling Feature: ASV_33_Lachnospiraceae_NK4A136_group</span>
<span class="co">#&gt; Modeling Feature: ASV_34_Alistipes_inops</span>
<span class="co">#&gt; Modeling Feature: ASV_35_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_36_Ruminococcaceae_UCG.002_bacterium</span>
<span class="co">#&gt; Modeling Feature: ASV_37_Roseburia_inulinivorans</span>
<span class="co">#&gt; Modeling Feature: ASV_38_Intestinibacter_bartlettii</span>
<span class="co">#&gt; Modeling Feature: ASV_39_Agathobacter</span>
<span class="co">#&gt; Modeling Feature: ASV_40_Blautia_faecis</span>
<span class="co">#&gt; Modeling Feature: ASV_41_Alistipes_finegoldii</span>
<span class="co">#&gt; Modeling Feature: ASV_42_Lachnospiraceae_NK4A136_group</span>
<span class="co">#&gt; Modeling Feature: ASV_43_Alistipes_shahii</span>
<span class="co">#&gt; Modeling Feature: ASV_44_Ruminococcus_1_bicirculans</span>
<span class="co">#&gt; Modeling Feature: ASV_45_Haemophilus_influenzae.parainfluenzae</span>
<span class="co">#&gt; Modeling Feature: ASV_46_Roseburia_hominis</span>
<span class="co">#&gt; Modeling Feature: ASV_47_Ruminiclostridium_6</span>
<span class="co">#&gt; Modeling Feature: ASV_48_Blautia_obeum</span>
<span class="co">#&gt; Modeling Feature: ASV_49_Alistipes_obesi</span>
<span class="co">#&gt; Modeling Feature: ASV_50_Parasutterella_excrementihominis</span>
<span class="co">#&gt; Modeling Feature: ASV_51_Ruminococcaceae_UCG.002</span>
<span class="co">#&gt; Modeling Feature: ASV_52_Roseburia_intestinalis</span>
<span class="co">#&gt; Modeling Feature: ASV_53_Ruminococcaceae_UCG.005</span>
<span class="co">#&gt; Modeling Feature: ASV_54_Bifidobacterium_breve.kashiwanohense.2</span>
<span class="co">#&gt; Modeling Feature: ASV_55_Coprococcus_3_comes</span>
<span class="co">#&gt; Modeling Feature: ASV_56_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_57_Romboutsia_ilealis.timonensis</span>
<span class="co">#&gt; Modeling Feature: ASV_58_Clostridium_sensu_stricto_1_celatum.disporicum.1</span>
<span class="co">#&gt; Modeling Feature: ASV_59_Lachnospira</span>
<span class="co">#&gt; Modeling Feature: ASV_60_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_61_Ruminococcaceae_UCG.005</span>
<span class="co">#&gt; Modeling Feature: ASV_62_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_63_Alistipes_ihumii</span>
<span class="co">#&gt; Modeling Feature: ASV_64_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_65_Lachnospiraceae_ND3007_group</span>
<span class="co">#&gt; Modeling Feature: ASV_66_Streptococcus</span>
<span class="co">#&gt; Modeling Feature: ASV_67_Christensenellaceae_R.7_group</span>
<span class="co">#&gt; Modeling Feature: ASV_68_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_69_Lachnospira_pectinoschiza</span>
<span class="co">#&gt; Modeling Feature: ASV_70_Ruminococcaceae_UCG.013</span>
<span class="co">#&gt; Modeling Feature: ASV_71_Anaerostipes_hadrus</span>
<span class="co">#&gt; Modeling Feature: ASV_72_Bilophila_wadsworthia</span>
<span class="co">#&gt; Modeling Feature: ASV_73_Faecalibacterium</span>
<span class="co">#&gt; Modeling Feature: ASV_74_Ruminococcaceae_NK4A214_group</span>
<span class="co">#&gt; Modeling Feature: ASV_75_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_76_Christensenellaceae_R.7_group</span>
<span class="co">#&gt; Modeling Feature: ASV_77_Odoribacter_splanchnicus</span>
<span class="co">#&gt; Modeling Feature: ASV_78_Ruminococcaceae_UCG.003</span>
<span class="co">#&gt; Modeling Feature: ASV_79_CAG.56</span>
<span class="co">#&gt; Modeling Feature: ASV_80_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_81_UBA1819</span>
<span class="co">#&gt; Modeling Feature: ASV_82_Lachnoclostridium</span>
<span class="co">#&gt; Modeling Feature: ASV_83_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_84_Dorea_formicigenerans</span>
<span class="co">#&gt; Modeling Feature: ASV_85_Coprococcus_1_catus</span>
<span class="co">#&gt; Modeling Feature: ASV_86_Collinsella_aerofaciens</span>
<span class="co">#&gt; Modeling Feature: ASV_87_Blautia</span>
<span class="co">#&gt; Modeling Feature: ASV_88_Lachnoclostridium</span>
<span class="co">#&gt; Modeling Feature: ASV_89_Ruminiclostridium_5</span>
<span class="co">#&gt; Modeling Feature: ASV_90_Subdoligranulum</span>
<span class="co">#&gt; Modeling Feature: ASV_91_Agathobacter</span>
<span class="co">#&gt; Modeling Feature: ASV_92_Ruminiclostridium_5</span>
<span class="co">#&gt; Modeling Feature: ASV_93_Oscillibacter</span>
<span class="co">#&gt; Modeling Feature: ASV_94_Lachnospiraceae_NK4A136_group</span>
<span class="co">#&gt; Modeling Feature: ASV_95_Butyricicoccus</span>
<span class="co">#&gt; Modeling Feature: ASV_96_Flavonifractor_plautii</span>
<span class="co">#&gt; Modeling Feature: ASV_97_Family_XIII_AD3011_group</span>
<span class="co">#&gt; Modeling Feature: ASV_98_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_99_Lachnospiraceae_FCS020_group</span>
<span class="co">#&gt; Modeling Feature: ASV_100_Lachnoclostridium</span>
<span class="co">#&gt; Modeling Feature: ASV_101_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: ASV_102_Clostridia</span>
<span class="co">#&gt; Modeling Feature: Genus_Bacteroides</span>
<span class="co">#&gt; Modeling Feature: Genus_Akkermansia</span>
<span class="co">#&gt; Modeling Feature: Genus_Agathobacter</span>
<span class="co">#&gt; Modeling Feature: Genus_Alistipes</span>
<span class="co">#&gt; Modeling Feature: Genus_Escherichia.Shigella</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcus_2</span>
<span class="co">#&gt; Modeling Feature: Genus_Faecalibacterium</span>
<span class="co">#&gt; Modeling Feature: Genus_Christensenellaceae_R.7_group</span>
<span class="co">#&gt; Modeling Feature: Genus_Subdoligranulum</span>
<span class="co">#&gt; Modeling Feature: Genus_Blautia</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcaceae_UCG.002</span>
<span class="co">#&gt; Modeling Feature: Genus_Parabacteroides</span>
<span class="co">#&gt; Modeling Feature: Genus_Fusicatenibacter</span>
<span class="co">#&gt; Modeling Feature: Genus_Anaerostipes</span>
<span class="co">#&gt; Modeling Feature: Genus_Bifidobacterium</span>
<span class="co">#&gt; Modeling Feature: Genus_Erysipelotrichaceae_UCG.003</span>
<span class="co">#&gt; Modeling Feature: Genus_Dorea</span>
<span class="co">#&gt; Modeling Feature: Genus_Lachnospiraceae_NK4A136_group</span>
<span class="co">#&gt; Modeling Feature: Genus_Roseburia</span>
<span class="co">#&gt; Modeling Feature: Genus_Intestinibacter</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcus_1</span>
<span class="co">#&gt; Modeling Feature: Genus_Haemophilus</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminiclostridium_6</span>
<span class="co">#&gt; Modeling Feature: Genus_Parasutterella</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcaceae_UCG.005</span>
<span class="co">#&gt; Modeling Feature: Genus_Coprococcus_3</span>
<span class="co">#&gt; Modeling Feature: Genus_Romboutsia</span>
<span class="co">#&gt; Modeling Feature: Genus_Clostridium_sensu_stricto_1</span>
<span class="co">#&gt; Modeling Feature: Genus_Lachnospira</span>
<span class="co">#&gt; Modeling Feature: Genus_Lachnospiraceae_ND3007_group</span>
<span class="co">#&gt; Modeling Feature: Genus_Streptococcus</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcaceae_UCG.013</span>
<span class="co">#&gt; Modeling Feature: Genus_Bilophila</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcaceae_NK4A214_group</span>
<span class="co">#&gt; Modeling Feature: Genus_Odoribacter</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminococcaceae_UCG.003</span>
<span class="co">#&gt; Modeling Feature: Genus_CAG.56</span>
<span class="co">#&gt; Modeling Feature: Genus_UBA1819</span>
<span class="co">#&gt; Modeling Feature: Genus_Lachnoclostridium</span>
<span class="co">#&gt; Modeling Feature: Genus_Coprococcus_1</span>
<span class="co">#&gt; Modeling Feature: Genus_Collinsella</span>
<span class="co">#&gt; Modeling Feature: Genus_Ruminiclostridium_5</span>
<span class="co">#&gt; Modeling Feature: Genus_Oscillibacter</span>
<span class="co">#&gt; Modeling Feature: Genus_Butyricicoccus</span>
<span class="co">#&gt; Modeling Feature: Genus_Flavonifractor</span>
<span class="co">#&gt; Modeling Feature: Genus_Family_XIII_AD3011_group</span>
<span class="co">#&gt; Modeling Feature: Genus_Lachnospiraceae_FCS020_group</span>
<span class="co">#&gt; Modeling Feature: Family_Bacteroidaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Akkermansiaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Lachnospiraceae</span>
<span class="co">#&gt; Modeling Feature: Family_Rikenellaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Enterobacteriaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Ruminococcaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Christensenellaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Tannerellaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Bifidobacteriaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Erysipelotrichaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Peptostreptococcaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Pasteurellaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Burkholderiaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Clostridiaceae_1</span>
<span class="co">#&gt; Modeling Feature: Family_Streptococcaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Desulfovibrionaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Marinifilaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Coriobacteriaceae</span>
<span class="co">#&gt; Modeling Feature: Family_Family_XIII</span>
<span class="co">#&gt; The otu_table() of the phyloseq output contains Box-Cox transformed residuals following linear regression.</span></code></pre></div>
<p>If you want, you can also add <code>normalization_plots = TRUE</code> and the function will output plots for each taxonomic feature showing the distribution before and after normalization.</p>
<p>Now if we check again, the data is no longer in count form.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/phyloseq/topics/otu_table-methods">otu_table</a></span>(ps)[<span class="dv">1</span><span class="op">:</span><span class="dv">5</span>, <span class="dv">1</span><span class="op">:</span><span class="dv">2</span>]
<span class="co">#&gt; OTU Table:          [2 taxa and 5 samples]</span>
<span class="co">#&gt;                      taxa are columns</span>
<span class="co">#&gt;          ASV_1_Bacteroides_vulgatus ASV_2_Bacteroides_dorei.vulgatus</span>
<span class="co">#&gt; High1.13                 -0.9132827                         1.868976</span>
<span class="co">#&gt; High1.17                  0.1409818                        -2.030233</span>
<span class="co">#&gt; High1.18                  0.5128513                        -2.136537</span>
<span class="co">#&gt; High1.19                  0.3554185                         1.982479</span>
<span class="co">#&gt; High1.1                   0.2403769                         2.297000</span></code></pre></div>
</div>
<div id="calculate-a-c-e-" class="section level2">
<h2 class="hasAnchor">
<a href="#calculate-a-c-e-" class="anchor"></a>Calculate A.C.E.</h2>
<p>After I’m satisfied with the normalization, I can use the <code><a href="../reference/calculate_ACE.html">calculate_ACE()</a></code> function to calculate the A.C.E. model. This function calls the <a href="https://www.rdocumentation.org/packages/mets/versions/1.2.3.1/topics/twinlm">twinlm</a> function from the <code>mets</code> R package. We’ll also set <code>verbose = FALSE</code> to supress the long list of taxa, like above.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
df &lt;-<span class="st"> </span><span class="kw"><a href="../reference/calculate_ACE.html">calculate_ACE</a></span>(ps, <span class="dt">dz =</span> <span class="st">"DZ"</span>, <span class="dt">zygosity =</span> <span class="st">"Zygosity"</span>, <span class="dt">family_id =</span> <span class="st">"Family_ID"</span>, <span class="dt">verbose =</span> <span class="ot">FALSE</span>)</code></pre></div>
<p>The output is a data.frame that contains all of the estimates of A, C, and E, as well as their taxonomy.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
<span class="kw"><a href="https://www.rdocumentation.org/packages/utils/topics/head">head</a></span>(df, <span class="dv">3</span>)
<span class="co">#&gt;                                   Kingdom        Phylum       Class</span>
<span class="co">#&gt; ASV_1_Bacteroides_vulgatus       Bacteria Bacteroidetes Bacteroidia</span>
<span class="co">#&gt; ASV_2_Bacteroides_dorei.vulgatus Bacteria Bacteroidetes Bacteroidia</span>
<span class="co">#&gt; ASV_3_Bacteroides_uniformis      Bacteria Bacteroidetes Bacteroidia</span>
<span class="co">#&gt;                                          Order         Family       Genus</span>
<span class="co">#&gt; ASV_1_Bacteroides_vulgatus       Bacteroidales Bacteroidaceae Bacteroides</span>
<span class="co">#&gt; ASV_2_Bacteroides_dorei.vulgatus Bacteroidales Bacteroidaceae Bacteroides</span>
<span class="co">#&gt; ASV_3_Bacteroides_uniformis      Bacteroidales Bacteroidaceae Bacteroides</span>
<span class="co">#&gt;                                         Species                lowest_rank</span>
<span class="co">#&gt; ASV_1_Bacteroides_vulgatus             vulgatus       Bacteroides_vulgatus</span>
<span class="co">#&gt; ASV_2_Bacteroides_dorei.vulgatus dorei/vulgatus Bacteroides_dorei/vulgatus</span>
<span class="co">#&gt; ASV_3_Bacteroides_uniformis           uniformis      Bacteroides_uniformis</span>
<span class="co">#&gt;                                    A_Estimate C_Estimate E_Estimate</span>
<span class="co">#&gt; ASV_1_Bacteroides_vulgatus       5.658374e-17 0.09304669  0.9069533</span>
<span class="co">#&gt; ASV_2_Bacteroides_dorei.vulgatus 3.272644e-15 0.04175862  0.9582414</span>
<span class="co">#&gt; ASV_3_Bacteroides_uniformis      1.337296e-15 0.04727433  0.9527257</span>
<span class="co">#&gt;                                         A_2.5%      C_2.5%    E_2.5%</span>
<span class="co">#&gt; ASV_1_Bacteroides_vulgatus       -8.004395e-09 -0.02080066 0.7931060</span>
<span class="co">#&gt; ASV_2_Bacteroides_dorei.vulgatus -1.185422e-07 -0.07290349 0.8435793</span>
<span class="co">#&gt; ASV_3_Bacteroides_uniformis      -7.218176e-08 -0.06729814 0.8381532</span>
<span class="co">#&gt;                                       A_97.5%   C_97.5%  E_97.5% rank</span>
<span class="co">#&gt; ASV_1_Bacteroides_vulgatus       8.004395e-09 0.2068940 1.020801  ASV</span>
<span class="co">#&gt; ASV_2_Bacteroides_dorei.vulgatus 1.185422e-07 0.1564207 1.072903  ASV</span>
<span class="co">#&gt; ASV_3_Bacteroides_uniformis      7.218176e-08 0.1618468 1.067298  ASV</span></code></pre></div>
</div>
<div id="plot" class="section level2">
<h2 class="hasAnchor">
<a href="#plot" class="anchor"></a>Plot</h2>
<p>Finally we can plot the results.</p>
<div class="sourceCode"><pre class="sourceCode r"><code class="sourceCode r">
p &lt;-<span class="st"> </span><span class="kw"><a href="../reference/plot_heritability.html">plot_heritability</a></span>(df, <span class="dt">cutoff =</span> <span class="fl">0.2</span>, <span class="dt">color =</span> <span class="st">"Family"</span>, <span class="dt">verbose =</span> <span class="ot">TRUE</span>)
<span class="co">#&gt; Plot output contains 17 ASVs, 11 Genera, 4 Families.</span>
p</code></pre></div>
<p><img src="mherit_files/figure-html/plot-1.png" width="960"></p>
<p>Don’t pay too much attention to the names of the taxa being displayed in this figure. There is a lot of data curation that needs to be done that I am not showing here.</p>
<p>This is a work in progress, so please let me know if you run into any problems. Thank you!</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="sidebar">
        <div id="tocnav">
      <h2 class="hasAnchor">
<a href="#tocnav" class="anchor"></a>Contents</h2>
      <ul class="nav nav-pills nav-stacked">
<li><a href="#load-pacakages">Load Pacakages</a></li>
      <li><a href="#import">Import</a></li>
      <li><a href="#subset">Subset</a></li>
      <li><a href="#filter">Filter</a></li>
      <li><a href="#prepare-dataset">Prepare Dataset</a></li>
      <li><a href="#normalize">Normalize</a></li>
      <li><a href="#calculate-a-c-e-">Calculate A.C.E.</a></li>
      <li><a href="#plot">Plot</a></li>
      </ul>
</div>
      </div>

</div>


      <footer><div class="copyright">
  <p>Developed by <a href="https://profiles.stanford.edu/daniel-sprockett">Daniel Sprockett</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.3.0.</p>
</div>
      </footer>
</div>

  

  </body>
</html>
